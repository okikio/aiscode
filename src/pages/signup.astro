---
import AuthLayout from '~/layouts/Auth.astro';

const user = Astro.locals?.user;
if (user) {
	return Astro.redirect("/");
}

export const prerender = false;
const csrfToken = 'your-csrf-token'; // Replace with actual token fetching logic if needed
---
<AuthLayout title="SignUp">
  <div class="login-sec">
    <div class="col-lg-5 col-11 m-auto">
      <div class="text-center mb-3">
        <div class="header-ads mobile-ads">
          <img src="/front/images/ad-left.png" alt="Ad Left" class="img-fluid" />
        </div>
      </div>
      <div class="login-from">
        <div class="form-header mb-lg-3 mb-2">
          <h2 class="f-15 text-uppercase text-white text-center mb-0 fw-700 montserrat-font">
            Donâ€™t have an account yet?
          </h2>
        </div>
        <form method="post" id="registerForm" name="registerForm" action="/api/signup">
          <input type="hidden" name="_token" value={csrfToken} />
          <div class="row g-2 align-items-center">
            <div class="col-md-12 form-group">
              <input type="text" class="form-control" id="username" placeholder="Username" name="username" required />
            </div>
            <div class="col-md-12 form-group">
              <input type="email" class="form-control" id="email" placeholder="Email" name="email" required />
            </div>
            <div class="col-md-6 form-group">
              <input type="password" class="form-control" id="password" placeholder="Password" name="password" autocomplete="new-password" required />
            </div>
            <div class="col-md-6 form-group">
              <input type="password" class="form-control" id="confirm_password" placeholder="Confirm Password" name="confirm_password" autocomplete="new-password" required />
            </div>
            <div class="form-group gx-2">
              <input type="checkbox" id="above_18" name="above_18" value="18+" required />
              <label class="text-white pl-2" for="above_18">I confirm that I am above 18 years old</label>
            </div>
          </div>
          <div class="mb-3 mt-1 text-center">
            <button class="gaming-btn btn btn-primary" type="submit">
              <span class="btn">Sign Up</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="/front/js/jquery-validation/jquery.validate.min.js" is:inline></script>
  <script src="/front/js/jquery-validation/additional-methods.min.js" is:inline></script>
  <script>
    // Custom JavaScript for form validation
    $(document).ready(function () {
      $('#registerForm').validate({
        rules: {
          password: {
            required: true,
            minlength: 6
          },
          confirm_password: {
            required: true,
            equalTo: '#password'
          },
          above_18: {
            required: true
          }
        },
        messages: {
          password: {
            required: 'Please enter a password',
            minlength: 'Your password must be at least 6 characters long'
          },
          confirm_password: {
            required: 'Please confirm your password',
            equalTo: 'Passwords do not match'
          },
          above_18: {
            required: 'Please confirm that you are 18 years old and above'
          }
        }
      });
    });
  </script>
</AuthLayout>
